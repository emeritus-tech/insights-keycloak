import{jsxs as m,Fragment as T,jsx as r}from"react/jsx-runtime";import{useState as C}from"react";import{a as F,y as O,h as B,ac as U,ad as k,ae as j,b5 as E,b6 as K,U as L,u as q,g as H,f as N,d as z,v as G,c as J,B as Q,l as P,cx as I,w as R,a3 as $,P as W,D as X,F as Y,A as Z,j as S,L as _,S as ee,cz as re,x as te,Q as ae}from"./main-DXDh8SEc.js";import{u as ie}from"./ConfirmDialog-o8TAA2Kj.js";import{D as oe}from"./DynamicComponents-oH6U-qv7.js";import{F as se}from"./FormAccess-Bcw0IOUQ.js";import{V as pe}from"./ViewHeader-DTd0a4sz.js";import{u as ne}from"./useParams-5577fL9S.js";import"react-dom";import"./ClientSelect-DzH7E0lJ.js";import"./FileUpload-CK_LBb0x.js";import"./CodeEditor-BFrRAdAy.js";import"./copy-icon-C4kUIpk5.js";import"./EmptyStateFooter-C_ktbNPy.js";import"./EmptyStateActions-CiPKPOdJ.js";import"./GroupPickerDialog-B6DOUphD.js";import"./PaginatingTableToolbar-zbU1l_6-.js";import"./DataListItemRow-CavOLjhh.js";import"./FlexItem-c5qvFYFZ.js";import"./KeySelect-BIWWws15.js";import"./useToggle-K3Kx99tM.js";import"./MultiLineInput-D3_8dp6S.js";import"./AddRoleMappingModal-BqIKRo9T.js";import"./KeycloakDataTable-B3eTS_qk.js";import"./Td-BmSS9qQq.js";import"./grip-vertical-icon-CgFEKIXW.js";import"./_baseFlatten-CMLUuI8z.js";import"./filter-icon-Do5tIUfA.js";const de=({mapperTypes:p,mapperType:t,form:d,id:f,updateMapperType:u})=>{const{t:o}=F(),{control:M}=d,[g,l]=C(!1),a=["inherit","import","legacy","force"];return m(T,{children:[r(O,{name:"name",label:o("name"),labelIcon:o("addIdpMapperNameHelp"),readOnly:!!f,rules:{required:o("required")}}),r(B,{name:"config.syncMode",label:o("syncModeOverride"),labelIcon:o("syncModeOverrideHelp"),options:a.map(i=>({key:i.toUpperCase(),value:o(`syncModes.${i}`)})),controller:{defaultValue:a[0].toUpperCase()}}),r(U,{label:o("mapperType"),labelIcon:r(k,{helpText:t.helpText,fieldLabelId:"mapperType"}),fieldId:"identityProviderMapper",children:r(j,{name:"identityProviderMapper",defaultValue:p[0].id,control:M,render:({field:i})=>r(E,{toggleId:"identityProviderMapper","data-testid":"idp-mapper-select",isDisabled:!!f,onToggle:()=>l(!g),onSelect:e=>{const y=e;u(y),i.onChange(y.id),l(!1)},selections:t.name,variant:K.single,"aria-label":o("mapperType"),isOpen:g,children:p.map(e=>r(L,{selected:e===i.value,"datatest-id":e.id,value:e,children:e.name},e.name))})})})]})};function Ke(){const{adminClient:p}=q(),{t}=F(),d=H({shouldUnregister:!0}),{handleSubmit:f}=d,{addAlert:u,addError:o}=N(),M=z(),g=G(),{realm:l}=J(),{id:a,providerId:i,alias:e}=ne(),[y,A]=C(),[v,h]=C(),V=async s=>{const b=ee(s),c={...b,config:{...b.config},identityProviderAlias:e};if(a)try{await p.identityProviders.updateMapper({id:a,alias:e},{...c,id:a}),u(t("mapperSaveSuccess"),P.success)}catch(n){o(t("mapperSaveError"),n)}else try{const n=await p.identityProviders.createMapper({identityProviderMapper:c,alias:e});u(t("mapperCreateSuccess"),P.success),M(re({realm:l,alias:e,providerId:i,id:n.id}))}catch(n){o(t("mapperCreateError"),n)}},[w,D]=ie({titleKey:"deleteProviderMapper",messageKey:t("deleteMapperConfirm",{mapper:v?.name}),continueButtonLabel:"delete",continueButtonVariant:Q.danger,onConfirm:async()=>{try{await p.identityProviders.delMapper({alias:e,id:a}),u(t("deleteMapperSuccess"),P.success),M(I({providerId:i,alias:e,tab:"mappers",realm:l}))}catch(s){o("deleteErrorIdentityProvider",s)}}});R(()=>Promise.all([a?p.identityProviders.findOneMapper({alias:e,id:a}):null,p.identityProviders.findMapperTypes({alias:e})]),([s,b])=>{const c=g(Object.values(b),te("name"));s?(h(c.find(({id:n})=>n===s.identityProviderMapper)),x(s)):h(c[0]),A(c)},[a]);const x=s=>{ae(s,d.setValue)};return!y||!v?r($,{}):m(W,{variant:"light",children:[r(D,{}),r(pe,{className:"kc-add-mapper-title",titleKey:a?t("editIdPMapper",{providerId:i[0].toUpperCase()+i.substring(1)}):t("addIdPMapper",{providerId:i[0].toUpperCase()+i.substring(1)}),dropdownItems:a?[r(X,{onClick:w,children:t("delete")},"delete")]:void 0,divider:!0}),m(se,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:f(V),className:"pf-v5-u-mt-lg",children:[m(Y,{...d,children:[a&&r(O,{name:"id",label:t("id"),readOnly:!0,rules:{required:t("required")}}),v.properties&&m(T,{children:[r(de,{form:d,id:a,mapperTypes:y,updateMapperType:h,mapperType:v}),r(oe,{properties:v.properties})]})]}),m(Z,{children:[r(S,{"data-testid":"new-mapper-save-button",variant:"primary",type:"submit",children:t("save")}),r(S,{"data-testid":"new-mapper-cancel-button",variant:"link",component:s=>r(_,{...s,to:I({realm:l,providerId:i,alias:e,tab:"mappers"})}),children:t("cancel")})]})]})]})}export{Ke as default};
//# sourceMappingURL=AddMapper-DRECEpj9.js.map
