import{jsxs as v,jsx as t,Fragment as O}from"react/jsx-runtime";import{u as F,a as A,f as T,c as L,g as x,M as I,r as E,j as g,B as U,aa as q,s as V,ac as M,am as P,l,D as N,au as j,P as K,b5 as G,U as w,cq as H}from"./main-DXDh8SEc.js";import{useState as h}from"react";import{u as $}from"./ConfirmDialog-o8TAA2Kj.js";import{V as z}from"./ViewHeader-DTd0a4sz.js";import{u as J}from"./useToggle-K3Kx99tM.js";import{S as Q}from"./SessionsTable-yNRb70y0.js";import{F as W}from"./filter-icon-Do5tIUfA.js";import"react-dom";import"./PaginatingTableToolbar-zbU1l_6-.js";import"./EmptyStateFooter-C_ktbNPy.js";import"./EmptyStateActions-CiPKPOdJ.js";import"./KeycloakDataTable-B3eTS_qk.js";import"./Td-BmSS9qQq.js";import"./grip-vertical-icon-CgFEKIXW.js";import"./_baseFlatten-CMLUuI8z.js";import"./useFormatDate-HcqQUSxN.js";import"./ListItem-CJzak8mO.js";const X=({handleModalToggle:n,save:c})=>{const{adminClient:a}=F(),{t:e}=A(),{addAlert:o}=T(),{realm:r,realmRepresentation:d,refresh:m}=L(),{register:S,handleSubmit:u}=x(),y=(s,p)=>{const B=s.successRequests?.length||0,i=s.failedRequests?.length||0;B===0&&i===0?o(e("noAdminUrlSet"),l.warning):i>0?(o(e(""+p+"Success",{successNodes:s.successRequests}),l.success),o(e(""+p+"Fail",{failedNodes:s.failedRequests}),l.danger)):o(e(""+p+"Success",{successNodes:s.successRequests}),l.success)},C=async()=>{try{await a.realms.update({realm:r},{realm:r,notBefore:Date.now()/1e3}),o(e("notBeforeSuccess"),l.success)}catch(s){o(e("setToNowError",{error:s}),l.danger)}},b=async()=>{try{await a.realms.update({realm:r},{realm:r,notBefore:0}),o(e("notBeforeClearedSuccess"),l.success),m()}catch(s){o(e("notBeforeError",{error:s}),l.danger)}},f=async()=>{const s=await a.realms.pushRevocation({realm:r});y(s,"notBeforePush"),m()};return v(I,{variant:E.small,title:e("revocation"),isOpen:!0,onClose:n,actions:[t(g,{"data-testid":"set-to-now-button",variant:"tertiary",onClick:()=>{C(),n()},form:"revocation-modal-form",children:e("setToNow")},"set-to-now"),t(g,{"data-testid":"clear-not-before-button",variant:"tertiary",onClick:()=>{b(),n()},form:"revocation-modal-form",children:e("clear")},"clear"),t(g,{"data-testid":"modal-test-connection-button",variant:"secondary",onClick:()=>{f(),n()},form:"revocation-modal-form",children:e("push")},"push"),t(g,{id:"modal-cancel","data-testid":"cancel",variant:U.link,onClick:()=>{n()},children:e("cancel")},"cancel")],children:[t(q,{className:"kc-revocation-description-text",children:e("revocationDescription")}),t(V,{id:"revocation-modal-form",isHorizontal:!0,onSubmit:u(c),children:t(M,{className:"kc-revocation-modal-form-group",label:e("notBefore"),name:"notBefore",fieldId:"not-before",children:t(P,{"data-testid":"not-before-input",autoFocus:!0,readOnly:!0,value:d?.notBefore===0?e("none"):new Date(d?.notBefore*1e3).toString(),type:"text",id:"not-before",...S("notBefore")})})})]})},Y=({filterType:n,onChange:c})=>{const{t:a}=A(),[e,o]=J();return v(G,{"data-testid":"filter-session-type-select",isOpen:e,onToggle:o,toggleIcon:t(W,{}),onSelect:r=>{c(r),o()},selections:n,children:[t(w,{"data-testid":"all-sessions-option",value:"ALL",children:a("sessionsType.allSessions")}),t(w,{"data-testid":"regular-sso-option",value:"REGULAR",children:a("sessionsType.regularSSO")}),t(w,{"data-testid":"offline-option",value:"OFFLINE",children:a("sessionsType.offline")})]})};function he(){const{adminClient:n}=F(),{t:c}=A(),[a,e]=h(0),o=()=>e(a+1),{addError:r}=T(),{realm:d}=L(),[m,S]=h(!1),[u,y]=h("ALL"),[C,b]=h(!1),f=()=>{S(!m)},s=async(i,k,D)=>{const R=await H(n,"ui-ext/sessions",{first:`${i}`,max:`${k}`,type:u,search:D||""});return b(R.length===0),R},[p,B]=$({titleKey:"logoutAllSessions",messageKey:"logoutAllDescription",continueButtonLabel:"confirm",onConfirm:async()=>{try{await n.realms.logoutAll({realm:d}),o()}catch(i){r("logoutAllSessionsError",i)}}});return v(O,{children:[t(B,{}),t(z,{dropdownItems:[t(N,{"data-testid":"revocation",component:"button",onClick:()=>f(),children:c("revocation")},"toggle-modal"),t(N,{"data-testid":"logout-all",component:"button",isDisabled:C,onClick:p,children:c("signOutAllActiveSessions")},"delete-role")],titleKey:"titleSessions",subKey:"sessionExplain",helpUrl:j.sessionsUrl}),v(K,{variant:"light",className:"pf-v5-u-p-0",children:[m&&t(X,{handleModalToggle:f,save:()=>{f()}}),t(Q,{loader:s,isSearching:u!=="ALL",isPaginated:!0,filter:t(Y,{filterType:u,onChange:i=>{y(i),o()}})},a)]})]})}export{he as default};
//# sourceMappingURL=SessionsSection-C6xVcjqH.js.map
