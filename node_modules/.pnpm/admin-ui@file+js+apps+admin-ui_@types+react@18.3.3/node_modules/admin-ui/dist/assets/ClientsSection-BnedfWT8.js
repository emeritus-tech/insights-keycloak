import{jsxs as c,Fragment as P,jsx as e}from"react/jsx-runtime";import{bE as W,u as M,a as f,f as F,c as g,d as X,B as N,l as Y,j as K,L as I,bF as j,b as re,v as oe,x as le,M as ce,r as de,e as Z,w as me,aT as ee,a2 as E,aS as H,ad as _,b3 as te,au as ue,P as pe,aQ as J,bC as ye,aR as he,bG as fe,aC as ie,bH as ge,bI as Ce,bJ as be}from"./main-DXDh8SEc.js";import{useState as L,useMemo as Te}from"react";import{u as V}from"./ConfirmDialog-o8TAA2Kj.js";import{V as De,F as Ae}from"./ViewHeader-DTd0a4sz.js";import{R as ne,u as ae}from"./RoutableTabs-CmXecBCx.js";import{K as $}from"./KeycloakDataTable-B3eTS_qk.js";import{L as Re}from"./PaginatingTableToolbar-zbU1l_6-.js";import{u as ke,F as G}from"./useFormatDate-HcqQUSxN.js";import{a0 as Ie,T as A,$ as O}from"./Td-BmSS9qQq.js";import{u as Le}from"./useToggle-K3Kx99tM.js";import{d as Ke,D as Q,a as U,b as q,c as S}from"./DataListItemRow-CavOLjhh.js";import{a as R,b as k}from"./Tabs-DuqZmBlh.js";import{i as Pe,g as ve}from"./utils-DeGqqWSp.js";import"react-dom";import"./PageHandler-BSpHpuNc.js";import"./DynamicComponents-oH6U-qv7.js";import"./ClientSelect-DzH7E0lJ.js";import"./FileUpload-CK_LBb0x.js";import"./CodeEditor-BFrRAdAy.js";import"./copy-icon-C4kUIpk5.js";import"./EmptyStateFooter-C_ktbNPy.js";import"./EmptyStateActions-CiPKPOdJ.js";import"./GroupPickerDialog-B6DOUphD.js";import"./FlexItem-c5qvFYFZ.js";import"./KeySelect-BIWWws15.js";import"./MultiLineInput-D3_8dp6S.js";import"./AddRoleMappingModal-BqIKRo9T.js";import"./filter-icon-Do5tIUfA.js";import"./useParams-5577fL9S.js";import"./PageList-BqPOEpg8.js";import"./_baseFlatten-CMLUuI8z.js";import"./grip-vertical-icon-CgFEKIXW.js";const we=()=>({className:Ie.modifiers.wrap}),xe=({rootUrl:t,baseUrl:i},n)=>i?.startsWith("http")?i:t==="${authAdminUrl}"?t.replace(/\$\{(authAdminUrl)\}/,n.adminBaseUrl):t==="${authBaseUrl}"?W(t.replace(/\$\{(authBaseUrl)\}/,n.serverBaseUrl),i||""):t?.startsWith("http")?i?W(t,i):t:i,Be=()=>{const{adminClient:t}=M(),{t:i}=f(),{addAlert:n,addError:o}=F(),{realm:s}=g(),l=ke(),p=X(),[d,a]=L(),y=async()=>{try{return await t.realms.getClientsInitialAccess({realm:s})}catch{return[]}},[h,C]=V({titleKey:"tokenDeleteConfirmTitle",messageKey:i("tokenDeleteConfirm",{id:d?.id}),continueButtonLabel:"delete",continueButtonVariant:N.danger,onConfirm:async()=>{try{await t.realms.delClientsInitialAccess({realm:s,id:d.id}),n(i("tokenDeleteSuccess"),Y.success),a(void 0)}catch(r){o("tokenDeleteError",r)}}});return c(P,{children:[e(C,{}),e($,{ariaLabelKey:"initialAccessToken",searchPlaceholderKey:"searchInitialAccessToken",loader:y,toolbarItem:e(K,{component:r=>e(I,{...r,to:j({realm:s})}),children:i("create")}),actions:[{title:i("delete"),onRowClick:r=>{a(r),h()}}],columns:[{name:"id",displayKey:"id"},{name:"timestamp",displayKey:"timestamp",cellRenderer:r=>l(new Date(r.timestamp*1e3),G)},{name:"expiration",displayKey:"expires",cellRenderer:r=>l(new Date(r.timestamp*1e3+r.expiration*1e3),G)},{name:"count",displayKey:"count"},{name:"remainingCount",displayKey:"remainingCount",transforms:[we]}],emptyState:e(Re,{message:i("noTokens"),instructions:i("noTokensInstructions"),primaryActionText:i("create"),onPrimaryAction:()=>p(j({realm:s}))})},d?.id)]})},Se=({onConfirm:t,toggleDialog:i})=>{const{t:n}=f(),o=re(),s=Object.keys(o.providers?.["client-registration-policy"].providers||[]),l=o.componentTypes?.["org.keycloak.services.clientregistration.policy.ClientRegistrationPolicy"],p=oe(),d=Te(()=>p(l?.filter(a=>s.includes(a.id))||[],le("id")),[s,l]);return e(ce,{variant:de.medium,title:n("chooseAPolicyProvider"),isOpen:!0,onClose:i,children:c(Ke,{onSelectDataListItem:(a,y)=>{t(y),i()},"aria-label":n("addPredefinedMappers"),isCompact:!0,children:[e(Q,{"aria-label":n("headerName"),id:"header",children:e(U,{children:e(q,{dataListCells:[n("name"),n("description")].map(a=>e(S,{style:{fontWeight:700},children:a},a))})})}),d.map(a=>e(Q,{"aria-label":a.id,"data-testid":a.id,id:a.id,children:e(U,{children:e(q,{dataListCells:[e(S,{width:2,children:a.id},`name-${a.id}`),e(S,{width:4,children:a.helpText},`description-${a.id}`)]})})},a.id))]})})},Ee=t=>{const{realm:i}=g(),{subTab:n}=Z();return e(I,{to:ee({realm:i,subTab:n||"anonymous",providerId:t.providerId,id:t.id}),children:t.name},t.id)},z=({subType:t})=>{const{adminClient:i}=M(),{t:n}=f(),{subTab:o}=Z(),s=X(),{addAlert:l,addError:p}=F(),{realm:d}=g(),[a,y]=L([]),[h,C]=L(),[r,b]=Le();me(()=>i.components.find({type:"org.keycloak.services.clientregistration.policy.ClientRegistrationPolicy"}),m=>y(m.filter(x=>x.subType===t)),[h]);const[v,w]=V({titleKey:"clientRegisterPolicyDeleteConfirmTitle",messageKey:n("clientRegisterPolicyDeleteConfirm",{name:h?.name}),continueButtonLabel:"delete",continueButtonVariant:N.danger,onConfirm:async()=>{try{await i.components.del({realm:d,id:h?.id}),l(n("clientRegisterPolicyDeleteSuccess")),C(void 0)}catch(m){p("clientRegisterPolicyDeleteError",m)}}});return c(P,{children:[r&&e(Se,{onConfirm:m=>s(ee({realm:d,subTab:o||"anonymous",providerId:m})),toggleDialog:b}),e(w,{}),e($,{ariaLabelKey:"clientRegistration",searchPlaceholderKey:n("searchClientRegistration"),"data-testid":`clientRegistration-${t}`,loader:a,toolbarItem:e(E,{children:e(K,{"data-testid":`createPolicy-${t}`,onClick:b,children:n("createPolicy")})}),actions:[{title:n("delete"),onRowClick:m=>{C(m),v()}}],columns:[{name:"name",displayKey:"name",cellRenderer:Ee},{name:"providerId",displayKey:"providerId"}]})]})},Me=()=>{const{t}=f(),{realm:i}=g(),n=l=>ae(H({realm:i,subTab:l})),o=n("anonymous"),s=n("authenticated");return c(ne,{defaultLocation:H({realm:i,subTab:"anonymous"}),mountOnEnter:!0,children:[e(R,{"data-testid":"anonymous",title:c(k,{children:[t("anonymousAccessPolicies")," ",e(_,{fieldLabelId:"",helpText:t("anonymousAccessPoliciesHelp"),noVerticalAlign:!1,unWrap:!0})]}),...o,children:e(z,{subType:"anonymous"})}),e(R,{"data-testid":"authenticated",title:c(k,{children:[t("authenticatedAccessPolicies")," ",e(_,{fieldLabelId:"",helpText:t("authenticatedAccessPoliciesHelp"),noVerticalAlign:!1,unWrap:!0})]}),...s,children:e(z,{subType:"authenticated"})})]})},Fe=t=>{const{t:i}=f(),{realm:n}=g();return e(O,{wrapModifier:"truncate",children:c(I,{to:he({realm:n,clientId:t.id,tab:"settings"}),children:[t.clientId,!t.enabled&&e(fe,{isRead:!0,className:"pf-v5-u-ml-sm",children:i("disabled")},`${t.id}-disabled`)]},t.id)})},Ne=t=>e(O,{wrapModifier:"truncate",children:ie()(t.name)}),Ve=t=>e(O,{wrapModifier:"truncate",children:ie()(t.description)}),$e=t=>{const{environment:i}=ge(),n=xe(t,i);return n?e(Ae,{href:n}):"â€”"},Oe=()=>{const{t}=f(),{realm:i}=g(),{hasAccess:n}=te();return n("manage-clients")?c(P,{children:[e(E,{children:e(K,{component:s=>e(I,{...s,to:Ce({realm:i})}),children:t("createClient")})}),e(E,{children:e(K,{component:s=>e(I,{...s,to:be({realm:i})}),variant:"link","data-testid":"importClient",children:t("importClient")})})]}):e("span",{})};function Tt(){const{adminClient:t}=M(),{t:i}=f(),{addAlert:n,addError:o}=F(),{realm:s}=g(),[l,p]=L(0),d=()=>p(new Date().getTime()),[a,y]=L(),{hasAccess:h}=te(),C=h("manage-clients"),r=async(u,T,D)=>{const B={first:u,max:T};return D&&(B.clientId=D,B.search=!0),await t.clients.find({...B})},b=u=>ae(J({realm:s,tab:u})),v=b("list"),w=b("initial-access-token"),m=b("client-registration"),[x,se]=V({titleKey:i("clientDelete",{clientId:a?.clientId}),messageKey:"clientDeleteConfirm",continueButtonLabel:"delete",continueButtonVariant:N.danger,onConfirm:async()=>{try{await t.clients.del({id:a.id}),n(i("clientDeletedSuccess"),Y.success),d()}catch(u){o("clientDeleteError",u)}}});return c(P,{children:[e(De,{titleKey:"clientList",subKey:"clientsExplain",helpUrl:ue.clientsUrl,divider:!1}),e(pe,{variant:"light",className:"pf-v5-u-p-0",children:c(ne,{mountOnEnter:!0,isBox:!0,defaultLocation:J({realm:s,tab:"list"}),children:[c(R,{"data-testid":"list",title:e(k,{children:i("clientsList")}),...v,children:[e(se,{}),e($,{loader:r,isPaginated:!0,ariaLabelKey:"clientList",searchPlaceholderKey:"searchForClient",toolbarItem:e(Oe,{}),actionResolver:u=>{const T=u.data,D=[{title:i("export"),onClick(){ye(T)}}];return!Pe(T)&&(C||T.access?.configure)&&D.push({title:i("delete"),onClick(){y(T),x()}}),D},columns:[{name:"clientId",displayKey:"clientId",transforms:[A(20)],cellRenderer:Fe},{name:"clientName",displayKey:"clientName",transforms:[A(20)],cellRenderer:Ne},{name:"protocol",displayKey:"type",transforms:[A(10)],cellRenderer:u=>ve(i,u.protocol??"openid-connect")},{name:"description",displayKey:"description",transforms:[A(30)],cellRenderer:Ve},{name:"baseUrl",displayKey:"homeURL",transforms:[A(20)],cellRenderer:$e}]},l)]}),e(R,{"data-testid":"initialAccessToken",title:e(k,{children:i("initialAccessToken")}),...w,children:e(Be,{})}),e(R,{"data-testid":"registration",title:e(k,{children:i("clientRegistration")}),...m,children:e(Me,{})})]})})]})}export{Tt as default};
//# sourceMappingURL=ClientsSection-BnedfWT8.js.map
