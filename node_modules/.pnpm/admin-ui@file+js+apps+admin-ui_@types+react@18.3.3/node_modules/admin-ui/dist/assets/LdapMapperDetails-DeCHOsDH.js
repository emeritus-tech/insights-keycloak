import{jsx as a,jsxs as k,Fragment as H}from"react/jsx-runtime";import{u as N,g as U,d as G,c as R,a as $,f as z,w as J,B as Q,l as V,ek as L,ab as W,a3 as X,D as I,P as Y,F as Z,y as v,ac as _,ad as ee,ae,b5 as re,b6 as te,U as oe,A as ne,j as M,Q as pe,S as se}from"./main-DXDh8SEc.js";import{useState as y}from"react";import{u as ie}from"./ConfirmDialog-o8TAA2Kj.js";import{c as de,D as le}from"./DynamicComponents-oH6U-qv7.js";import{F as ce}from"./FormAccess-Bcw0IOUQ.js";import{V as me}from"./ViewHeader-DTd0a4sz.js";import{u as ue}from"./useParams-5577fL9S.js";import"react-dom";import"./ClientSelect-DzH7E0lJ.js";import"./FileUpload-CK_LBb0x.js";import"./CodeEditor-BFrRAdAy.js";import"./copy-icon-C4kUIpk5.js";import"./EmptyStateFooter-C_ktbNPy.js";import"./EmptyStateActions-CiPKPOdJ.js";import"./GroupPickerDialog-B6DOUphD.js";import"./PaginatingTableToolbar-zbU1l_6-.js";import"./DataListItemRow-CavOLjhh.js";import"./FlexItem-c5qvFYFZ.js";import"./KeySelect-BIWWws15.js";import"./useToggle-K3Kx99tM.js";import"./MultiLineInput-D3_8dp6S.js";import"./AddRoleMappingModal-BqIKRo9T.js";import"./KeycloakDataTable-B3eTS_qk.js";import"./Td-BmSS9qQq.js";import"./grip-vertical-icon-CgFEKIXW.js";import"./_baseFlatten-CMLUuI8z.js";import"./filter-icon-Do5tIUfA.js";function Ue(){const{adminClient:l}=N(),p=U(),[i,P]=y(),[c,x]=y(),{id:f,mapperId:o}=ue(),m=G(),{realm:g}=R(),{t:e}=$(),{addAlert:h,addError:b}=z(),[w,D]=y(!1),[F,K]=y(0),O=()=>K(F+1);J(async()=>{const t=await l.components.listSubComponents({id:f,type:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper"});if(o&&o!=="new"){const r=await l.components.findOne({id:o});return{components:t,fetchedMapper:r}}return{components:t}},({components:t,fetchedMapper:r})=>{if(P(r),x(t),o!=="new"&&!r)throw new Error(e("notFound"));r&&S(r)},[]);const S=t=>{pe(t,p.setValue)},E=async t=>{const r=se(t),n={...r,config:Object.entries(r.config||{}).reduce((u,[q,T])=>(u[q]=Array.isArray(T)?T:[T],u),{})};try{o==="new"?(await l.components.create(n),m(L({realm:g,id:t.parentId,tab:"mappers"}))):await l.components.update({id:o},n),S(n),h(e(o==="new"?"mappingCreatedSuccess":"mappingUpdatedSuccess"),V.success)}catch(u){b(o==="new"?"mappingCreatedError":"mappingUpdatedError",u)}},C=async t=>{try{const r=await l.userStorageProvider.mappersSync({parentId:i?.parentId||"",id:o,direction:t});h(e("syncLDAPGroupsSuccessful",{result:r.status}))}catch(r){b("syncLDAPGroupsError",r)}O()},[j,B]=ie({titleKey:"deleteMappingTitle",messageKey:"deleteMappingConfirm",continueButtonLabel:"delete",continueButtonVariant:Q.danger,onConfirm:async()=>{try{await l.components.del({id:i.id}),h(e("mappingDeletedSuccess"),V.success),m(L({id:f,realm:g,tab:"mappers"}))}catch(t){b("mappingDeletedError",t)}}}),A=W({control:p.control,name:"providerId"});if(!c)return a(X,{});const d=o==="new",s=c.find(t=>t.id===A);return k(H,{children:[a(B,{}),a(me,{titleKey:i?i.name:e("createNewMapper"),dropdownItems:d?void 0:[a(I,{onClick:j,children:e("delete")},"delete"),...s?.metadata.fedToKeycloakSyncSupported?[a(I,{onClick:()=>C("fedToKeycloak"),children:e(s.metadata.fedToKeycloakSyncMessage)},"fedSync")]:[],...s?.metadata.keycloakToFedSyncSupported?[a(I,{onClick:()=>{C("keycloakToFed")},children:e(s.metadata.keycloakToFedSyncMessage)},"ldapSync")]:[]]},F),a(Y,{variant:"light",isFilled:!0,children:a(Z,{...p,children:k(ce,{role:"manage-realm",isHorizontal:!0,onSubmit:p.handleSubmit(()=>E(p.getValues())),children:[!d&&a(v,{name:"id",label:e("id"),isDisabled:!0}),a(v,{name:"name",label:e("name"),labelIcon:e("mapperNameHelp"),isDisabled:!d,rules:{required:e("required")}}),a("input",{type:"hidden",defaultValue:d?f:i?i.parentId:"","data-testid":"ldap-mapper-parentId",...p.register("parentId")}),a("input",{type:"hidden",defaultValue:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper","data-testid":"ldap-mapper-provider-type",...p.register("providerType")}),d?a(_,{label:e("mapperType"),labelIcon:a(ee,{helpText:s?.helpText?s.helpText:e("mapperTypeHelp"),fieldLabelId:"mapperType"}),fieldId:"kc-providerId",isRequired:!0,children:a(ae,{name:"providerId",defaultValue:"",control:p.control,"data-testid":"ldap-mapper-type-select",render:({field:t})=>a(re,{toggleId:"kc-providerId",typeAheadAriaLabel:e("mapperType"),onToggle:()=>D(!w),isOpen:w,onSelect:r=>{S({providerId:r,...Object.fromEntries(c.find(n=>n.id===r)?.properties.filter(n=>n.type==="List").map(n=>[de(n.name),n.options?.[0]])||[])}),D(!1)},selections:t.value,variant:te.typeahead,"aria-label":e("selectMapperType"),children:c.map(r=>a(oe,{value:r.id,children:r.id},r.id))})})}):a(v,{name:"providerId",label:e("mapperType"),labelIcon:s?.helpText?s.helpText:e("mapperTypeHelp"),rules:{required:e("required")},isDisabled:!d}),!!A&&a(le,{properties:s?.properties}),k(ne,{children:[a(M,{isDisabled:!p.formState.isDirty,variant:"primary",type:"submit","data-testid":"ldap-mapper-save",children:e("save")}),a(M,{variant:"link",onClick:()=>m(d?-1:`/${g}/user-federation/ldap/${i.parentId}/mappers`),"data-testid":"ldap-mapper-cancel",children:e("cancel")})]})]})})})]})}export{Ue as default};
//# sourceMappingURL=LdapMapperDetails-DeCHOsDH.js.map
