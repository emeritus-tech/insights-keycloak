import{jsx as t,jsxs as c,Fragment as k}from"react/jsx-runtime";import{u as L,b3 as T,c as ne,w as D,j as I,L as R,ei as se,dX as oe,bQ as le,bh as V,eo as de,a as M,h as ce,b6 as ue,f as me,dt as pe,F as be,ac as f,am as x,ad as v,ep as fe,y as g,dQ as he,ai as Ae,a4 as ge,ae as ye,bb as ke,bc as E,ag as ve,ah as Ie,aq as Le,A as we,i as Ge,dv as qe,l as S}from"./main-DXDh8SEc.js";import{useState as h,useEffect as Oe}from"react";import{D as Ce}from"./SwitchControl-BOCtuOhh.js";import{F as Fe}from"./FormAccess-Bcw0IOUQ.js";import{G as Ue}from"./GroupPickerDialog-B6DOUphD.js";import{u as je}from"./useFormatDate-HcqQUSxN.js";const Ve=({user:r})=>{const{adminClient:n}=L(),e=T(),{realm:o}=ne(),[s,l]=h();return D(()=>e.hasAccess("view-realm")?n.components.findOne({id:r.federationLink||r.origin}):n.userStorageProvider.name({id:r.federationLink||r.origin}),l,[]),s?e.hasAccess("view-realm")?t(I,{variant:"link",component:b=>t(R,{...b,to:se({id:s.id,providerId:s.providerId,realm:o})}),children:s.name}):t("span",{children:s.name}):null};function xe(r){const n={};Object.entries(r.attributes||{}).forEach(([o,s])=>n[oe(o)]=s);const e=le(r.unmanagedAttributes);return{...r,attributes:n,unmanagedAttributes:e}}function Pe(r){const n=r.username?.trim(),e=Array.isArray(r.attributes)?V(r.attributes):Object.fromEntries(Object.entries(r.attributes||{}).map(([s,l])=>[de(s),l])),o=Array.isArray(r.unmanagedAttributes)?V(r.unmanagedAttributes):r.unmanagedAttributes;for(const s in o)if(e&&Object.hasOwn(e,s))throw Error(`Attribute ${s} is a managed attribute and is already available from the user details.`);return{...r,username:n,attributes:{...o,...e},unmanagedAttributes:void 0}}function Be(r={},n={}){return Object.fromEntries(Object.entries(r).filter(([e])=>!Object.hasOwn(n,e)))}const Ee=({name:r,label:n,help:e})=>{const{adminClient:o}=L(),{t:s}=M(),[l,b]=h([]);return D(()=>o.authenticationManagement.getRequiredActions(),d=>{const u=d.filter(A=>A.enabled);b(u)},[]),t(ce,{name:r,label:s(n),labelIcon:s(e),controller:{defaultValue:[]},isScrollable:!0,maxMenuHeight:"375px",variant:ue.typeaheadMulti,chipGroupProps:{numChips:3},placeholderText:s("requiredActionPlaceholder"),menuAppendTo:"parent",options:l.map(({alias:d,name:u})=>({key:d,value:u||d}))})},ze=({form:r,realm:n,user:e,bruteForce:{isBruteForceProtected:o,isLocked:s}={isBruteForceProtected:!1,isLocked:!1},userProfileMetadata:l,save:b,refresh:d,onGroupsUpdate:u})=>{const{adminClient:A}=L(),{t:a}=M(),H=je(),{addAlert:w,addError:G}=me(),{hasAccess:q}=T(),N=q("manage-users"),P=q("view-realm"),{whoAmI:B}=pe(),z=B.getLocale(),{handleSubmit:Q,setValue:O,watch:J,control:K,reset:W,formState:C}=r,{errors:X}=C,_=J("username"),[m,F]=h([]),[U,y]=h(!1),[j,$]=h(s);Oe(()=>{O("requiredActions",e?.requiredActions||[])},[e,O]);const Y=async()=>{try{await A.users.update({id:e.id},{enabled:!0}),w(a("unlockSuccess"),S.success),d&&d()}catch(i){G("unlockError",i)}},Z=i=>{F(m.filter(p=>p.name!==i)),u?.(m)},ee=async i=>{F([...m,...i]),u?.([...m,...i])},te=async i=>{i.forEach(async re=>{try{await A.users.addToGroup({id:e.id,groupId:re.id}),w(a("addedGroupMembership"),S.success)}catch(ie){G("addedGroupMembershipError",ie)}})},ae=()=>{y(!U)};return t(Fe,{isHorizontal:!0,onSubmit:Q(b),role:"query-users",fineGrainedAccess:e?.access?.manage,className:"pf-v5-u-mt-lg",children:c(be,{...r,children:[U&&t(Ue,{type:"selectMany",text:{title:"selectGroups",ok:"join"},canBrowse:N,onConfirm:i=>{e?.id?te(i||[]):ee(i||[]),y(!1)},onClose:()=>y(!1),filterGroups:m}),e?.id&&c(k,{children:[t(f,{label:a("id"),fieldId:"kc-id",isRequired:!0,children:t(x,{id:e.id,"aria-label":a("userID"),value:e.id,readOnly:!0})}),t(f,{label:a("createdAt"),fieldId:"kc-created-at",isRequired:!0,children:t(x,{value:H(new Date(e.createdTimestamp)),id:"kc-created-at",readOnly:!0})})]}),t(Ee,{name:"requiredActions",label:"requiredUserActions",help:"requiredUserActionsHelp"}),(e?.federationLink||e?.origin)&&P&&t(f,{label:a("federationLink"),labelIcon:t(v,{helpText:a("federationLinkHelp"),fieldLabelId:"federationLink"}),children:t(Ve,{user:e})}),l?c(k,{children:[t(Ce,{name:"emailVerified",label:a("emailVerified"),labelIcon:a("emailVerifiedHelp")}),t(fe,{form:r,userProfileMetadata:l,hideReadOnly:!e,supportedLocales:n.supportedLocales||[],currentLocale:z,t:(i,p)=>a(i,p)})]}):c(k,{children:[!n.registrationEmailAsUsername&&t(g,{name:"username",label:a("username"),readOnly:!!e?.id&&!n.editUsernameAllowed&&n.editUsernameAllowed!==void 0,rules:{required:a("required")}}),t(g,{name:"email",label:a("email"),type:"email",rules:{pattern:{value:he,message:a("emailInvalid")}}}),t(Ae,{name:"emailVerified",label:a("emailVerified"),labelIcon:a("emailVerifiedHelp"),labelOn:a("yes"),labelOff:a("no")}),t(g,{name:"firstName",label:a("firstName")}),t(g,{name:"lastName",label:a("lastName")})]}),o&&t(f,{label:a("temporaryLocked"),fieldId:"temporaryLocked",labelIcon:t(v,{helpText:a("temporaryLockedHelp"),fieldLabelId:"temporaryLocked"}),children:t(ge,{"data-testid":"user-locked-switch",id:"temporaryLocked",onChange:(i,p)=>{Y(),$(p)},isChecked:j,isDisabled:!j,label:a("on"),labelOff:a("off")})}),!e?.id&&c(f,{label:a("groups"),fieldId:"kc-groups",labelIcon:t(v,{helpText:a("groupsHelp"),fieldLabelId:"groups"}),children:[t(ye,{name:"groups",defaultValue:[],control:K,render:()=>c(ke,{children:[t(E,{children:t(ve,{categoryName:" ",children:m.map(i=>t(Ie,{onClick:()=>Z(i.name),children:i.path},i.id))})}),t(E,{children:t(I,{id:"kc-join-groups-button",onClick:ae,variant:"secondary","data-testid":"join-groups-button",children:a("joinGroups")})})]})}),X.requiredActions&&t(Le,{message:a("required")})]}),c(we,{children:[t(Ge,{formState:C,"data-testid":e?.id?"save-user":"create-user",isDisabled:!e?.id&&!_&&n.registrationEmailAsUsername===!1,allowNonDirty:!0,allowInvalid:!0,children:e?.id?a("save"):a("create")}),t(I,{"data-testid":"cancel-create-user",variant:"link",onClick:e?.id?()=>W(xe(e)):void 0,component:e?.id?void 0:i=>t(R,{...i,to:qe({realm:n.realm})}),children:e?.id?a("revert"):a("cancel")})]})]})})};export{Ve as F,Ee as R,ze as U,xe as a,Be as f,Pe as t};
//# sourceMappingURL=UserForm-kxKdaFcM.js.map
