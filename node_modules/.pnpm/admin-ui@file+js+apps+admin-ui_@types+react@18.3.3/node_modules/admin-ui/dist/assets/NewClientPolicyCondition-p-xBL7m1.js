import{jsxs as f,Fragment as J,jsx as n}from"react/jsx-runtime";import{u as K,a as $,f as q,d as M,c as Q,e as W,b as X,g as Y,w as Z,P as _,ac as ii,ad as oi,ae as ei,b5 as ni,b6 as ti,U as ri,F as si,A as ai,j as g,dT as P,L as ci,l as di}from"./main-DXDh8SEc.js";import{useState as a}from"react";import{D as li}from"./DynamicComponents-oH6U-qv7.js";import{F as pi}from"./FormAccess-Bcw0IOUQ.js";import{V as mi}from"./ViewHeader-DTd0a4sz.js";import{c as S}from"./camelCase-BnQg9BCB.js";import"react-dom";import"./ClientSelect-DzH7E0lJ.js";import"./FileUpload-CK_LBb0x.js";import"./CodeEditor-BFrRAdAy.js";import"./copy-icon-C4kUIpk5.js";import"./EmptyStateFooter-C_ktbNPy.js";import"./EmptyStateActions-CiPKPOdJ.js";import"./GroupPickerDialog-B6DOUphD.js";import"./PaginatingTableToolbar-zbU1l_6-.js";import"./DataListItemRow-CavOLjhh.js";import"./FlexItem-c5qvFYFZ.js";import"./KeySelect-BIWWws15.js";import"./useToggle-K3Kx99tM.js";import"./MultiLineInput-D3_8dp6S.js";import"./AddRoleMappingModal-BqIKRo9T.js";import"./KeycloakDataTable-B3eTS_qk.js";import"./Td-BmSS9qQq.js";import"./grip-vertical-icon-CgFEKIXW.js";import"./_baseFlatten-CMLUuI8z.js";import"./ConfirmDialog-o8TAA2Kj.js";import"./filter-icon-Do5tIUfA.js";import"./capitalize-uHuMSGb3.js";import"./_baseSlice-F8doVSIJ.js";function Ji(){const{adminClient:v}=K(),{t:e}=$(),{addAlert:I,addError:w}=q(),h=M(),{realm:C}=Q(),[x,b]=a(!1),[d,D]=a(!1),[N,T]=a([]),[G,V]=a([]),[B,H]=a(),[p,O]=a(""),[k,A]=a([]),{policyName:c,conditionName:t}=W(),j=X(),m=Y(),F=j.componentTypes?.["org.keycloak.services.clientpolicy.condition.ClientPolicyConditionProvider"],E=r=>{m.reset({config:r.configuration||{}})};Z(()=>v.clientPolicies.listPolicies({includeGlobalPolicies:!0}),r=>{if(T(r.policies??[]),t){let i=r.policies?.find(o=>o.name===c);i===void 0&&(i=r.globalPolicies?.find(o=>o.name===c),D(i!==void 0));const l=i?.conditions?.find(o=>o.condition===t),u=F?.find(o=>o.id===t);H(l),A(u?.properties),E(l)}},[]);const L=async r=>{const i=r.config,l=()=>k.reduce((o,s)=>(o[s.name]=i[s.name],o),{}),u=N.map(o=>{if(o.name!==c)return o;let s=o.conditions??[];if(t){const R={condition:B?.condition,configuration:l()},y=s.findIndex(z=>t===z.condition);if(y===-1)return;const U=[...s.slice(0,y),R,...s.slice(y+1)];return{...o,conditions:U}}return s=s.concat({condition:G[0].condition,configuration:l()}),{...o,conditions:s}});try{await v.clientPolicies.updatePolicy({policies:u}),T(u),h(P({realm:C,policyName:c})),I(e(t?"updateClientConditionSuccess":"createClientConditionSuccess"),di.success)}catch(o){w("createClientConditionError",o)}};return f(J,{children:[n(mi,{titleKey:e(t?d?"viewCondition":"editCondition":"addCondition"),divider:!0}),f(_,{variant:"light",children:[f(pi,{isHorizontal:!0,role:"manage-realm",isReadOnly:d,className:"pf-v5-u-mt-lg",onSubmit:m.handleSubmit(L),children:[n(ii,{label:e("conditionType"),fieldId:"conditionType",labelIcon:n(oi,{helpText:p?`${S(p.replace(/-/g," "))}Help`:"conditionsHelp",fieldLabelId:"conditionType"}),children:n(ei,{name:"conditions",defaultValue:"any-client",control:m.control,render:({field:r})=>n(ni,{placeholderText:e("selectACondition"),className:"kc-conditionType-select","data-testid":"conditionType-select",toggleId:"provider",isDisabled:!!t,onToggle:i=>b(i),onSelect:i=>{r.onChange(i),A(i.properties),O(i.id),V([{condition:i.id}]),b(!1)},selections:t||p,variant:ti.single,"aria-label":e("conditionType"),isOpen:x,children:F?.map(i=>n(ri,{selected:i.id===r.value,description:e(S(i.id.replace(/-/g," "))),value:i,children:i.id},i.id))})})}),n(si,{...m,children:n(li,{properties:k})}),!d&&f(ai,{children:[n(g,{variant:"primary",type:"submit","data-testid":"addCondition-saveBtn",isDisabled:p===""&&!t&&d,children:e(t?"save":"add")}),n(g,{variant:"link","data-testid":"addCondition-cancelBtn",onClick:()=>h(P({realm:C,policyName:c})),children:e("cancel")})]})]}),d&&n("div",{className:"kc-backToProfile",children:n(g,{component:r=>n(ci,{...r,to:P({realm:C,policyName:c})}),variant:"primary",children:e("back")})})]})]})}export{Ji as default};
//# sourceMappingURL=NewClientPolicyCondition-p-xBL7m1.js.map
