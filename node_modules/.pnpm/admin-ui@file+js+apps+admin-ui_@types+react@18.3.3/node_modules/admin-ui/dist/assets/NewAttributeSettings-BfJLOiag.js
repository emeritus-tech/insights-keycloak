import{jsx as e,jsxs as u,Fragment as O}from"react/jsx-runtime";import{a as I,ac as N,bu as ae,bv as B,u as ye,c as ve,aj as F,ab as $,w as U,a3 as we,F as te,ad as x,am as ce,aq as Ie,ay as De,j as L,h as Re,ar as X,R as W,ae as j,b5 as Y,b6 as ue,U as ee,a4 as xe,bS as me,b as ge,g as fe,M as Pe,r as Ee,s as Te,B as Oe,as as Le,Z as He,$ as Ge,d as Me,f as ze,P as We,b1 as $e,L as je,e6 as ke,e0 as Be,l as Ke,Q as Ue,ef as Fe}from"./main-DXDh8SEc.js";import{useState as T,useEffect as Ne,useMemo as _e}from"react";import{F as ne,a as Je}from"./FormAccess-Bcw0IOUQ.js";import{V as Qe}from"./ViewHeader-DTd0a4sz.js";import{u as Ze}from"./useLocale-DROFIzrk.js";import{u as le}from"./useParams-5577fL9S.js";/* empty css                               */import{U as Xe}from"./UserProfileContext-CHRVofPr.js";import{K as Ye}from"./KeyValueInput-CUdRH2bO.js";import{u as ie}from"./useToggle-K3Kx99tM.js";import{u as ea}from"./ConfirmDialog-o8TAA2Kj.js";import{D as aa}from"./DynamicComponents-oH6U-qv7.js";import{U as ta,V as na,W as pe,X as Q,Y as la,Z}from"./Td-BmSS9qQq.js";import{A as ia,G as ra}from"./AddTranslationsDialog-DVAIO-dB.js";import{D as sa}from"./SwitchControl-BOCtuOhh.js";import{i as oa}from"./isEqual-DfpijAgC.js";import"react-dom";import"./copy-icon-C4kUIpk5.js";import"./KeySelect-BIWWws15.js";import"./EmptyStateFooter-C_ktbNPy.js";import"./ClientSelect-DzH7E0lJ.js";import"./FileUpload-CK_LBb0x.js";import"./CodeEditor-BFrRAdAy.js";import"./EmptyStateActions-CiPKPOdJ.js";import"./GroupPickerDialog-B6DOUphD.js";import"./PaginatingTableToolbar-zbU1l_6-.js";import"./DataListItemRow-CavOLjhh.js";import"./FlexItem-c5qvFYFZ.js";import"./MultiLineInput-D3_8dp6S.js";import"./AddRoleMappingModal-BqIKRo9T.js";import"./KeycloakDataTable-B3eTS_qk.js";import"./_baseFlatten-CMLUuI8z.js";import"./filter-icon-Do5tIUfA.js";import"./grip-vertical-icon-CgFEKIXW.js";const da=()=>{const{t}=I();return e(ne,{role:"manage-realm",isHorizontal:!0,children:e(N,{hasNoPaddingTop:!0,label:t("annotations"),fieldId:"kc-annotations",className:"kc-annotations-label",children:e(ae,{className:"kc-annotations",children:e(B,{children:e(Ye,{name:"annotations",label:t("annotations"),defaultKeyValue:[{key:"inputType",label:t("inputType"),values:["text","textarea","select","select-radiobuttons","multiselect","multiselect-checkboxes","html5-email","html5-tel","html5-url","html5-number","html5-range","html5-datetime-local","html5-date","html5-month","html5-week","html5-time"]},{key:"inputHelperTextBefore",label:t("inputHelperTextBefore")},{key:"inputHelperTextAfter",label:t("inputHelperTextAfter")},{key:"inputOptionLabelsI18nPrefix",label:t("inputOptionLabelsI18nPrefix")},{key:"inputTypePlaceholder",label:t("inputTypePlaceholder")},{key:"inputTypeSize",label:t("inputTypeSize")},{key:"inputTypeCols",label:t("inputTypeCols")},{key:"inputTypeRows",label:t("inputTypeRows")},{key:"inputTypeStep",label:t("inputTypeStep")},{key:"kcNumberFormat",label:t("kcNumberFormat")},{key:"kcNumberUnFormat",label:t("kcNumberUnFormat")}]})})})})})},he=[{label:"requiredForLabel.both",value:["admin","user"]},{label:"requiredForLabel.users",value:["user"]},{label:"requiredForLabel.admins",value:["admin"]}],ca=({onHandlingTranslationData:t,onHandlingGeneratedDisplayName:p})=>{const{adminClient:c}=ye(),{t:a}=I(),{realmRepresentation:i}=ve(),l=F(),[h,f]=T(),[C,o]=T(),[y,H]=T(!1),[v,S]=T(!1),[P,G]=ie(),{attributeName:M}=le(),D=!!M,[z,g]=T(""),[b,r]=T(""),[w,A]=T(),[k,E]=T({key:"",translations:[]}),m=/\$\{([^}]+)\}/,d=(n,s)=>{g(s);const V=s!==""&&i?.internationalizationEnabled?`\${profile.attributes.${s}}`:"";r(V)},q=$({control:l.control,name:"hasSelector"}),_=$({control:l.control,name:"hasRequiredScopes"}),Ce=$({control:l.control,name:"isRequired",defaultValue:!1}),K=$({control:l.control,name:"displayName"}),qe=m.test(K);U(()=>c.clientScopes.find(),f,[]),U(()=>c.users.getProfile(),o,[]);const re=n=>{t(n)},se=n=>{p(n)};if(Ne(()=>{re(k),se(b)},[k,b]),!h)return e(we,{});function oe(n){l.setValue("hasSelector",n)}function de(n){l.setValue("hasRequiredScopes",n)}const Ve=n=>{E(n)},Se=()=>{G(),re(k),se(b)},Ae=K?.substring(2,K.length-1);return u(O,{children:[P&&e(ia,{translationKey:D?Ae:`profile.attributes.${z}`,translations:k,type:w??"displayName",onTranslationsAdded:Ve,toggleDialog:Se,onCancel:()=>{G()}}),e(ne,{role:"manage-realm",isHorizontal:!0,children:u(te,{...l,children:[u(N,{label:a("attributeName"),labelIcon:e(x,{helpText:a("upAttributeNameHelp"),fieldLabelId:"attributeName"}),fieldId:"kc-attribute-name",isRequired:!0,children:[e(ce,{isRequired:!0,id:"kc-attribute-name",defaultValue:"","data-testid":"attribute-name",isDisabled:D,validated:l.formState.errors.name?"error":"default",...l.register("name",{required:!0}),onChange:d}),l.formState.errors.name&&e(Ie,{message:a("validateAttributeName")})]}),e(N,{label:a("attributeDisplayName"),labelIcon:e(x,{helpText:a("attributeDisplayNameHelp"),fieldLabelId:"attributeDisplayName"}),fieldId:"kc-attribute-display-name",children:u(ae,{hasGutter:!0,children:[u(B,{span:i?.internationalizationEnabled?11:12,children:[e(ce,{id:"kc-attribute-display-name","data-testid":"attribute-display-name",isDisabled:i?.internationalizationEnabled&&z!==""||D&&qe,value:D?K:i?.internationalizationEnabled?b:void 0,...l.register("displayName")}),b&&e(De,{className:"pf-v5-u-mt-sm",variant:"info",isInline:!0,isPlain:!0,title:a("addAttributeTranslationInfo")})]}),i?.internationalizationEnabled&&e(B,{span:1,children:e(L,{variant:"link",className:"pf-m-plain kc-attribute-display-name-iconBtn","data-testid":"addAttributeTranslationBtn","aria-label":a("addAttributeTranslationBtn"),isDisabled:!z&&!D,onClick:()=>{A("displayName"),G()},icon:e(ra,{})})})]})}),e(sa,{name:"multivalued",label:a("multivalued"),labelIcon:a("multivaluedHelp")}),e(Re,{name:"group",label:a("attributeGroup"),labelIcon:a("attributeGroupHelp"),controller:{defaultValue:""},options:[{key:"",value:a("none")},...C?.groups?.map(n=>({key:n.name,value:n.name}))||[]]}),!ba.includes(M)&&u(O,{children:[e(X,{}),u(N,{label:a("enabledWhen"),labelIcon:e(x,{helpText:a("enabledWhenTooltip"),fieldLabelId:"enabled-when"}),fieldId:"enabledWhen",hasNoPaddingTop:!0,children:[e(W,{id:"always","data-testid":"always",isChecked:!q,name:"enabledWhen",label:a("always"),onChange:()=>oe(!1),className:"pf-v5-u-mb-md"}),e(W,{id:"scopesAsRequested","data-testid":"scopesAsRequested",isChecked:q,name:"enabledWhen",label:a("scopesAsRequested"),onChange:()=>oe(!0),className:"pf-v5-u-mb-md"})]}),q&&e(N,{fieldId:"kc-scope-enabled-when",children:e(j,{name:"selector.scopes",control:l.control,defaultValue:[],render:({field:n})=>e(Y,{"data-testid":"enabled-when-scope-field",variant:ue.typeaheadMulti,typeAheadAriaLabel:"Select",chipGroupProps:{numChips:3,expandedText:a("hide"),collapsedText:a("showRemaining")},onToggle:s=>H(s),selections:n.value,onSelect:s=>{const V=s.toString();let R=[""];n.value?R=n.value.includes(V)?n.value.filter(J=>J!==V):[...n.value,V]:R=[V],n.onChange(R)},onClear:()=>{n.onChange([])},isOpen:y,"aria-labelledby":"scope",children:h.map(s=>e(ee,{value:s.name,children:s.name},s.name))})})})]}),M!=="username"&&u(O,{children:[e(X,{}),e(N,{label:a("required"),labelIcon:e(x,{helpText:a("requiredHelp"),fieldLabelId:"required"}),fieldId:"kc-required",hasNoPaddingTop:!0,children:e(j,{name:"isRequired","data-testid":"required",defaultValue:!1,control:l.control,render:({field:n})=>e(xe,{id:"kc-required",onChange:n.onChange,isChecked:n.value,label:a("on"),labelOff:a("off"),"aria-label":a("required")})})}),Ce&&u(O,{children:[e(N,{label:a("requiredFor"),fieldId:"requiredFor",hasNoPaddingTop:!0,children:e(j,{name:"required.roles","data-testid":"requiredFor",defaultValue:he[0].value,control:l.control,render:({field:n})=>e("div",{className:"kc-requiredFor",children:he.map(s=>e(W,{id:s.label,"data-testid":s.label,isChecked:oa(n.value,s.value),name:"roles",onChange:()=>{n.onChange(s.value)},label:a(s.label),className:"kc-requiredFor-option"},s.label))})})}),u(N,{label:a("requiredWhen"),labelIcon:e(x,{helpText:a("requiredWhenTooltip"),fieldLabelId:"required-when"}),fieldId:"requiredWhen",hasNoPaddingTop:!0,children:[e(W,{id:"requiredAlways","data-testid":"requiredAlways",isChecked:!_,name:"requiredWhen",label:a("always"),onChange:()=>de(!1),className:"pf-v5-u-mb-md"}),e(W,{id:"requiredScopesAsRequested","data-testid":"requiredScopesAsRequested",isChecked:_,name:"requiredWhen",label:a("scopesAsRequested"),onChange:()=>de(!0),className:"pf-v5-u-mb-md"})]}),_&&e(N,{fieldId:"kc-scope-required-when",children:e(j,{name:"required.scopes",control:l.control,defaultValue:[],render:({field:n})=>e(Y,{"data-testid":"required-when-scope-field",variant:ue.typeaheadMulti,typeAheadAriaLabel:"Select",chipGroupProps:{numChips:3,expandedText:a("hide"),collapsedText:a("showRemaining")},onToggle:s=>S(s),selections:n.value,onSelect:s=>{const V=s.toString();let R=[""];n.value?R=n.value.includes(V)?n.value.filter(J=>J!==V):[...n.value,V]:R=[V],n.onChange(R)},onClear:()=>{n.onChange([])},isOpen:v,"aria-labelledby":"scope",children:h.map(s=>e(ee,{value:s.name,children:s.name},s.name))})})})]})]})]})})]})},be=({name:t})=>{const{t:p}=I(),{control:c}=F();return e(ae,{children:e(j,{name:`permissions.${t}`,control:c,defaultValue:[],render:({field:a})=>u(O,{children:[e(B,{lg:4,sm:6,children:e(me,{id:`user-${t}`,label:p("user"),value:"user","data-testid":`user-${t}`,isChecked:a.value.includes("user"),onChange:()=>{const i="user",l=a.value.includes(i)?a.value.filter(h=>h!==i):[...a.value,i];a.onChange(l)}})}),e(B,{lg:8,sm:6,children:e(me,{id:`admin-${t}`,label:p("admin"),value:"admin","data-testid":`admin-${t}`,isChecked:a.value.includes("admin"),onChange:()=>{const i="admin",l=a.value.includes(i)?a.value.filter(h=>h!==i):[...a.value,i];a.onChange(l)}})})]})})})},ua=()=>{const{t}=I();return u(ne,{role:"manage-realm",isHorizontal:!0,children:[e(N,{hasNoPaddingTop:!0,label:t("whoCanEdit"),labelIcon:e(x,{helpText:t("whoCanEditHelp"),fieldLabelId:"whoCanEdit"}),fieldId:"kc-who-can-edit",children:e(be,{name:"edit"})}),e(N,{hasNoPaddingTop:!0,label:t("whoCanView"),labelIcon:e(x,{helpText:t("whoCanViewHelp"),fieldLabelId:"whoCanView"}),fieldId:"kc-who-can-view",children:e(be,{name:"view"})})]})},ma=({selectedValidators:t,onChange:p})=>{const{t:c}=I(),a=ge().componentTypes?.["org.keycloak.validate.Validator"]||[],i=_e(()=>a.filter(({id:o})=>!t.includes(o)),[t]),[l,h]=ie(),[f,C]=T();return e(N,{label:c("validatorType"),fieldId:"validator",children:e(Y,{toggleId:"validator",onToggle:h,onSelect:o=>{const y=o;p(y),C(y),h()},selections:f?.id,variant:"single","aria-label":c("selectOne"),isOpen:l,placeholderText:c("choose"),menuAppendTo:"parent",maxHeight:300,children:i.map(o=>e(ee,{selected:f?.id===o.id,value:o,description:o.helpText,children:o.id},o.id))})})},pa=({selectedValidators:t,toggleDialog:p,onConfirm:c})=>{const{t:a}=I(),[i,l]=T(),h=ge().componentTypes?.["org.keycloak.validate.Validator"].length===t.length,f=fe(),{handleSubmit:C}=f,o=y=>{c({...y,id:i?.id}),p()};return e(Pe,{variant:Ee.small,title:a("addValidator"),isOpen:!0,onClose:p,actions:[e(L,{"data-testid":"save-validator-role-button",variant:"primary",type:"submit",form:"add-validator",children:a("save")},"save"),e(L,{"data-testid":"cancel-validator-role-button",variant:"link",onClick:p,children:a("cancel")},"cancel")],children:h?a("emptyValidators"):u(Te,{id:"add-validator",onSubmit:C(o),children:[e(ma,{selectedValidators:t.map(y=>y.key),onChange:l}),i&&e(te,{...f,children:e(aa,{properties:i.properties})})]})})},ha=()=>{const{t}=I(),[p,c]=ie(),[a,i]=T(),{setValue:l,control:h,register:f,getValues:C}=F(),o=$({name:"validations",control:h,defaultValue:[]});Ne(()=>{f("validations")},[f]);const[y,H]=ea({titleKey:t("deleteValidatorConfirmTitle"),messageKey:t("deleteValidatorConfirmMsg",{validatorName:a}),continueButtonLabel:"delete",continueButtonVariant:Oe.danger,onConfirm:async()=>{const v=o.filter(S=>S.key!==a);l("validations",[...v])}});return u(O,{children:[p&&e(pa,{selectedValidators:o,onConfirm:v=>{const S=C("annotations");v.id==="options"&&!S.find(P=>P.key==="inputType")&&l("annotations",[...S,{key:"inputType",value:"select"}]),l("validations",[...o,{key:v.id,value:v.config}])},toggleDialog:c}),e(H,{}),u("div",{className:"kc-attributes-validations",children:[e(L,{id:"addValidator",onClick:()=>c(),variant:"link","data-testid":"addValidator",className:"kc--attributes-validations--add-validation-button",icon:e(Le,{}),children:t("addValidator")}),e(X,{}),o.length!==0?u(ta,{children:[e(na,{children:u(pe,{children:[e(Q,{children:t("validatorColNames.colName")}),e(Q,{children:t("validatorColNames.colConfig")}),e(Q,{"aria-hidden":"true"})]})}),e(la,{children:o.map(v=>u(pe,{children:[e(Z,{dataLabel:t("validatorColNames.colName"),children:v.key}),e(Z,{dataLabel:t("validatorColNames.colConfig"),children:JSON.stringify(v.value)}),e(Z,{className:"kc--attributes-validations--action-cell",children:e(L,{variant:"link","data-testid":"deleteValidator",onClick:()=>{y(),i(v.key)},children:t("delete")},"validator")})]},v.key))})]}):e(He,{className:"kc-emptyValidators",component:Ge.p,children:t("emptyValidators")})]})]})},ba=["username","email"],ya=({onHandlingTranslationsData:t,onHandlingGeneratedDisplayName:p,save:c})=>{const{t:a}=I(),i=F(),{realm:l,attributeName:h}=le(),f=!!h,C=y=>{t(y)},o=y=>{p(y)};return u(Xe,{children:[e($e,{label:a("jumpToSection"),sections:[{title:a("generalSettings"),panel:e(ca,{onHandlingTranslationData:C,onHandlingGeneratedDisplayName:o})},{title:a("permission"),panel:e(ua,{})},{title:a("validations"),panel:e(ha,{})},{title:a("annotations"),panel:e(da,{})}]}),e(Te,{onSubmit:i.handleSubmit(c),children:u(Je,{name:"attribute-settings",children:[e(L,{variant:"primary",type:"submit","data-testid":"attribute-create",children:a(f?"save":"create")}),e(je,{to:ke({realm:l,tab:"attributes"}),"data-testid":"attribute-cancel",className:"kc-attributeCancel",children:a("cancel")})]})})]})};function Xa(){const{adminClient:t}=ye(),{realm:p,attributeName:c}=le(),{realmRepresentation:a}=ve(),i=fe(),{t:l}=I(),h=Ze(),f=Me(),{addAlert:C,addError:o}=ze(),[y,H]=T(null),v=!!c,[S,P]=T({key:"",translations:[]}),[G,M]=T("");U(async()=>{const g=[];return await Promise.all(h.map(async b=>{try{const r=await t.realms.getRealmLocalizationTexts({realm:p,selectedLocale:b}),w=i.getValues(),A=w.displayName?.substring(2,w.displayName.length-1),k=[];Object.entries(r).map(([d,q])=>({key:d,value:q})).forEach(d=>{d.key===A&&k.push({locale:b,value:d.value})});const m={key:A,translations:k};g.push(m)}catch(r){console.error(`Error fetching translations for ${b}:`,r)}})),g},g=>{P(()=>({key:g[0].key,translations:g.flatMap(b=>b.translations)}))},[h]),U(()=>t.users.getProfile(),g=>{H(g);const{annotations:b,validations:r,permissions:w,selector:A,required:k,multivalued:E,...m}=g.attributes.find(d=>d.name===c)||{permissions:{edit:["admin"]}};Ue({...m,hasSelector:typeof A<"u",hasRequiredScopes:typeof k?.scopes<"u"},i.setValue),Object.entries(Fe({permissions:w,selector:A,required:k},{safe:!0})).map(([d,q])=>i.setValue(d,q)),i.setValue("annotations",Object.entries(b||{}).map(([d,q])=>({key:d,value:q}))),i.setValue("validations",Object.entries(r||{}).map(([d,q])=>({key:d,value:q}))),i.setValue("isRequired",k!==void 0),i.setValue("multivalued",E===!0)},[]);const D=async()=>{try{const g=S.translations.map(async b=>{try{await t.realms.addLocalization({realm:p,selectedLocale:b.locale,key:S.key},b.value)}catch{console.error(`Error saving translation for ${b.locale}`)}});await Promise.all(g)}catch(g){console.error(`Error saving translations: ${g}`)}},z=async({hasSelector:g,hasRequiredScopes:b,...r})=>{g||delete r.selector,b||delete r.required?.scopes;const w=r.validations.reduce((m,d)=>(m[d.key]=d.value||{},m),{}),A=r.annotations.reduce((m,d)=>Object.assign(m,{[d.key]:d.value}),{}),k=()=>(y?.attributes||[]).map(m=>m.name!==c?m:(delete m.required,Object.assign({...m,name:c,displayName:r.displayName,selector:r.selector,permissions:r.permissions,multivalued:r.multivalued,annotations:A,validations:w},r.isRequired?{required:r.required}:void 0,r.group?{group:r.group}:{group:null}))),E=()=>(y?.attributes||[]).concat([Object.assign({name:r.name,displayName:r.displayName||G,required:r.isRequired?r.required:void 0,selector:r.selector,permissions:r.permissions,multivalued:r.multivalued,annotations:A,validations:w},r.isRequired?{required:r.required}:void 0,r.group?{group:r.group}:void 0)]);if(a?.internationalizationEnabled&&!S.translations.some(d=>d.value.trim()!=="")&&!r.displayName){o("createAttributeError",l("translationError"));return}try{const m=v?k():E();await t.users.updateProfile({...y,attributes:m,realm:p}),await D(),Be.reloadResources(),f(ke({realm:p,tab:"attributes"})),C(l("createAttributeSuccess"),Ke.success)}catch(m){o("createAttributeError",m)}};return u(te,{...i,children:[e(Qe,{titleKey:v?c:l("createAttribute"),subKey:v?"":l("createAttributeSubTitle")}),e(We,{variant:"light",children:e(ya,{save:()=>i.handleSubmit(z)(),onHandlingTranslationsData:P,onHandlingGeneratedDisplayName:M})})]})}export{ba as USERNAME_EMAIL,Xa as default};
//# sourceMappingURL=NewAttributeSettings-BfJLOiag.js.map
