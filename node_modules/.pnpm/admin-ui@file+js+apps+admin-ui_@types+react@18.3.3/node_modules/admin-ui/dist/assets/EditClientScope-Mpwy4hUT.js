import{jsx as t,jsxs as S,Fragment as k}from"react/jsx-runtime";import{useState as w}from"react";import{u as j,a as L,d as N,c as U,f as z,at as H,w as _,B as q,l,aw as G,a3 as J,D as Q,P as f,ax as T,ay as W,az as X,S as Y}from"./main-DXDh8SEc.js";import{c as Z,C as v,A as $}from"./ClientScopeTypes-DaGfhuW4.js";import{u as ee}from"./ConfirmDialog-o8TAA2Kj.js";import{R as te}from"./AddRoleMappingModal-BqIKRo9T.js";import{R as oe,u as ae}from"./RoutableTabs-CmXecBCx.js";import{V as ie}from"./ViewHeader-DTd0a4sz.js";import{u as se}from"./useParams-5577fL9S.js";import{M as ne}from"./MapperList-D-E46ujn.js";import{S as re}from"./ScopeForm-Bgdtwy4X.js";import{a as g,b as h}from"./Tabs-DuqZmBlh.js";import"react-dom";import"./PaginatingTableToolbar-zbU1l_6-.js";import"./EmptyStateFooter-C_ktbNPy.js";import"./EmptyStateActions-CiPKPOdJ.js";import"./KeycloakDataTable-B3eTS_qk.js";import"./Td-BmSS9qQq.js";import"./grip-vertical-icon-CgFEKIXW.js";import"./_baseFlatten-CMLUuI8z.js";import"./filter-icon-Do5tIUfA.js";import"./PageHandler-BSpHpuNc.js";import"./DynamicComponents-oH6U-qv7.js";import"./ClientSelect-DzH7E0lJ.js";import"./FileUpload-CK_LBb0x.js";import"./CodeEditor-BFrRAdAy.js";import"./copy-icon-C4kUIpk5.js";import"./GroupPickerDialog-B6DOUphD.js";import"./DataListItemRow-CavOLjhh.js";import"./FlexItem-c5qvFYFZ.js";import"./KeySelect-BIWWws15.js";import"./useToggle-K3Kx99tM.js";import"./MultiLineInput-D3_8dp6S.js";import"./PageList-BqPOEpg8.js";import"./utils-DeGqqWSp.js";import"./SwitchControl-BOCtuOhh.js";import"./FormAccess-Bcw0IOUQ.js";function Je(){const{adminClient:n}=j(),{t:a}=L(),y=N(),{realm:d}=U(),{id:r}=se(),{addAlert:c,addError:p}=z(),{enabled:D}=H(),[i,M]=w(),[C,A]=w(0),b=()=>A(C+1);_(async()=>{const e=await n.clientScopes.findOne({id:r});if(!e)throw new Error(a("notFound"));return{...e,type:await R(e)}},e=>{M(e)},[C,r]);async function R(e){return(await n.clientScopes.listDefaultClientScopes()).find(u=>u.name===e.name)?v.default:(await n.clientScopes.listDefaultOptionalClientScopes()).find(u=>u.name===e.name)?v.optional:$.none}const m=e=>ae(X({realm:d,id:r,tab:e})),E=m("settings"),x=m("mappers"),I=m("scope"),P=async e=>{const o=Y({...e,name:e.name?.trim().replace(/ /g,"_")});try{await n.clientScopes.update({id:r},o),await Z(n,{...o,id:r},o.type),c(a("updateSuccessClientScope"),l.success)}catch(s){p("updateErrorClientScope",s)}},[V,B]=ee({titleKey:a("deleteClientScope",{count:1,name:i?.name}),messageKey:"deleteConfirmClientScopes",continueButtonLabel:"delete",continueButtonVariant:q.danger,onConfirm:async()=>{try{await n.clientScopes.del({id:r}),c(a("deletedSuccessClientScope"),l.success),y(G({realm:d}))}catch(e){p("deleteErrorClientScope",e)}}}),F=async e=>{try{const o=e.filter(s=>s.client===void 0).map(s=>s.role).flat();await n.clientScopes.addRealmScopeMappings({id:r},o),await Promise.all(e.filter(s=>s.client!==void 0).map(s=>n.clientScopes.addClientScopeMappings({id:r,client:s.client.id},[s.role]))),c(a("roleMappingUpdatedSuccess"),l.success)}catch(o){p("roleMappingUpdatedError",o)}},K=async e=>{if(Array.isArray(e))try{await n.clientScopes.addMultipleProtocolMappers({id:i.id},e),b(),c(a("mappingCreatedSuccess"),l.success)}catch(o){p("mappingCreatedError",o)}else{const o=e;y(T({realm:d,id:i.id,mapperId:o.id}))}},O=async e=>{try{await n.clientScopes.delProtocolMapper({id:i.id,mapperId:e.id}),c(a("mappingDeletedSuccess"),l.success),b()}catch(o){p("mappingDeletedError",o)}return!0};return i?S(k,{children:[t(B,{}),t(ie,{titleKey:i.name,dropdownItems:[t(Q,{onClick:V,children:a("delete")},"delete")],badges:[{text:i.protocol}],divider:!1}),t(f,{variant:"light",className:"pf-v5-u-p-0",children:S(oe,{isBox:!0,children:[t(g,{id:"settings","data-testid":"settings",title:t(h,{children:a("settings")}),...E,children:t(f,{variant:"light",children:t(re,{save:P,clientScope:i})})}),t(g,{id:"mappers","data-testid":"mappers",title:t(h,{children:a("mappers")}),...x,children:t(ne,{model:i,onAdd:K,onDelete:O,detailLink:e=>T({realm:d,id:i.id,mapperId:e})})}),S(g,{id:"scope","data-testid":"scopeTab",title:t(h,{children:a("scope")}),...I,children:[D&&t(f,{children:t(W,{variant:"info",isInline:!0,title:a("clientScopesRolesScope"),component:"h2"})}),t(te,{id:i.id,name:i.name,type:"clientScopes",save:F})]})]})})]}):t(J,{})}export{Je as default};
//# sourceMappingURL=EditClientScope-Mpwy4hUT.js.map
