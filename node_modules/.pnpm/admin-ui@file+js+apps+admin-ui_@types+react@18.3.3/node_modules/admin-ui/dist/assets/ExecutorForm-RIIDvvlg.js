import{jsxs as u,Fragment as M,jsx as o}from"react/jsx-runtime";import{u as R,a as W,d as q,f as Q,b as X,g as Y,w as Z,P as _,ac as $,ad as k,ae as ee,b5 as te,b6 as oe,U as re,F as ce,A as ie,j as g,L as F,dW as h,l as se}from"./main-DXDh8SEc.js";import{useState as l}from"react";import{D as ae}from"./DynamicComponents-oH6U-qv7.js";import{F as ne}from"./FormAccess-Bcw0IOUQ.js";import{V as le}from"./ViewHeader-DTd0a4sz.js";import{u as V}from"./useParams-5577fL9S.js";import"react-dom";import"./ClientSelect-DzH7E0lJ.js";import"./FileUpload-CK_LBb0x.js";import"./CodeEditor-BFrRAdAy.js";import"./copy-icon-C4kUIpk5.js";import"./EmptyStateFooter-C_ktbNPy.js";import"./EmptyStateActions-CiPKPOdJ.js";import"./GroupPickerDialog-B6DOUphD.js";import"./PaginatingTableToolbar-zbU1l_6-.js";import"./DataListItemRow-CavOLjhh.js";import"./FlexItem-c5qvFYFZ.js";import"./KeySelect-BIWWws15.js";import"./useToggle-K3Kx99tM.js";import"./MultiLineInput-D3_8dp6S.js";import"./AddRoleMappingModal-BqIKRo9T.js";import"./KeycloakDataTable-B3eTS_qk.js";import"./Td-BmSS9qQq.js";import"./grip-vertical-icon-CgFEKIXW.js";import"./_baseFlatten-CMLUuI8z.js";import"./ConfirmDialog-o8TAA2Kj.js";import"./filter-icon-Do5tIUfA.js";const I={config:{},executor:""};function we(){const{adminClient:P}=R(),{t:i}=W(),A=q(),{realm:d,profileName:a}=V(),{executorName:n}=V(),{addAlert:C,addError:H}=Q(),[N,T]=l(!1),p=X().componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[m,O]=l([]),[B,D]=l([]),[v,G]=l([]),[L,j]=l([]),f=Y({defaultValues:I}),{control:w,reset:y,handleSubmit:U}=f,c=!!n,E=e=>{const r=e.find(s=>s.name===a)?.executors?.find(s=>s.executor===n);r&&y({config:r.configuration})};Z(()=>P.clientPolicies.listProfiles({includeGlobalProfiles:!0}),e=>{G(e.globalProfiles),j(e.profiles),E(e.profiles),E(e.globalProfiles)},[]);const z=async()=>{const e=f.getValues(),t=L.map(r=>{if(r.name!==a)return r;const s=(r.executors??[]).concat({executor:e.executor,configuration:e.config||{}});if(c){const S=r.executors.find(K=>K.executor===n);S.configuration={...S.configuration,...e.config}}return c?r:{...r,executors:s}});try{await P.clientPolicies.createProfiles({profiles:t,globalProfiles:v}),C(i(c?"updateExecutorSuccess":"addExecutorSuccess"),se.success),A(h({realm:d,profileName:a}))}catch(r){H(c?"updateExecutorError":"addExecutorError",r)}},x=v.find(e=>e.name===a),b=p?.find(e=>e.id===n),J=b?.properties.map(e=>{const t=c?e.defaultValue:"";return{...e,defaultValue:t}});return u(M,{children:[o(le,{titleKey:c?n:i("addExecutor"),divider:!0}),u(_,{variant:"light",children:[u(ne,{isHorizontal:!0,role:"manage-realm",className:"pf-v5-u-mt-lg",isReadOnly:!!x,children:[o($,{label:i("executorType"),fieldId:"kc-executorType",labelIcon:m.length>0&&m[0].helpText!==""?o(k,{helpText:m[0].helpText,fieldLabelId:"executorTypeHelpText"}):c?o(k,{helpText:b?.helpText,fieldLabelId:"executorTypeHelpText"}):void 0,children:o(ee,{name:"executor",defaultValue:"",control:w,render:({field:e})=>o(te,{toggleId:"kc-executor",placeholderText:"Select an executor",onToggle:t=>T(t),onSelect:t=>{y({...I,executor:t.toString()});const r=p?.filter(s=>s.id===t);O(r??[]),D(r?.[0].properties??[]),T(!1)},selections:c?n:e.value,variant:oe.single,"data-testid":"executorType-select","aria-label":i("executorType"),isOpen:N,maxHeight:580,isDisabled:c,children:p?.map(t=>o(re,{selected:t.id===e.value,value:t.id,description:t.helpText,children:t.id},t.id))})})}),o(ce,{...f,children:o(ae,{properties:c?J:B})}),!x&&u(ie,{children:[o(g,{variant:"primary",onClick:()=>U(z)(),"data-testid":"addExecutor-saveBtn",children:i(c?"save":"add")}),o(g,{variant:"link",component:e=>o(F,{...e,to:h({realm:d,profileName:a})}),"data-testid":"addExecutor-cancelBtn",children:i("cancel")})]})]}),c&&x&&o("div",{className:"kc-backToProfile",children:o(g,{component:e=>o(F,{...e,to:h({realm:d,profileName:a})}),variant:"primary",children:i("back")})})]})]})}export{we as default};
//# sourceMappingURL=ExecutorForm-RIIDvvlg.js.map
