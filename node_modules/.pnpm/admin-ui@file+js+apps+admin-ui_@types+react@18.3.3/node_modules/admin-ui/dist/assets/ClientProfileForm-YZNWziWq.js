import{jsx as e,jsxs as o,Fragment as x}from"react/jsx-runtime";import{u as U,a as W,d as Z,g as Q,b4 as X,f as Y,b as _,w as ee,B as te,l as y,dW as N,dU as T,a3 as re,q as ie,D as ae,P as oe,F as le,y as se,O as ne,A as ce,j as d,L as P,Z as w,$ as L,ad as S,eb as de,as as me,ec as ue,ar as fe}from"./main-DXDh8SEc.js";import{useState as h,useMemo as pe,Fragment as xe}from"react";import{u as Pe}from"./ConfirmDialog-o8TAA2Kj.js";import{F as he}from"./FormAccess-Bcw0IOUQ.js";import{V as Ce}from"./ViewHeader-DTd0a4sz.js";import{u as be}from"./useParams-5577fL9S.js";/* empty css                               */import{F as ge,a as A}from"./FlexItem-c5qvFYFZ.js";import{d as ve,D as ke,a as ye,b as Te,c as Ee}from"./DataListItemRow-CavOLjhh.js";import{T as De}from"./trash-icon-BYngUEUG.js";import"react-dom";import"./copy-icon-C4kUIpk5.js";const Fe={name:"",description:"",executors:[]};function Oe(){const{adminClient:p}=U(),{t}=W(),C=Z(),E=Q({defaultValues:Fe,mode:"onChange"}),{handleSubmit:V,setValue:b,getValues:B,formState:{isDirty:D},control:H}=E,{fields:g,remove:K}=X({name:"executors",control:H}),{addAlert:v,addError:k}=Y(),[m,G]=h(),[a,j]=h(!1),{realm:n,profileName:l}=be(),q=_(),O=pe(()=>q.componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[]),[u,$]=h(),c=!!l,[F,M]=h(0),R=()=>M(F+1);ee(()=>p.clientPolicies.listProfiles({includeGlobalProfiles:!0}),r=>{G({globalProfiles:r.globalProfiles,profiles:r.profiles?.filter(f=>f.name!==l)});const s=r.globalProfiles?.find(f=>f.name===l),i=r.profiles?.find(f=>f.name===l);j(s!==void 0),b("name",s?.name??i?.name??""),b("description",s?.description??i?.description??""),b("executors",s?.executors??i?.executors??[])},[F]);const z=async r=>{const s=r;try{await p.clientPolicies.createProfiles({...m,profiles:[...m?.profiles||[],s]}),v(t(c?"updateClientProfileSuccess":"createClientProfileSuccess"),y.success),C(N({realm:n,profileName:r.name}))}catch(i){k(c?"updateClientProfileError":"createClientProfileError",i)}},[I,J]=Pe({titleKey:u?.name?t("deleteExecutorProfileConfirmTitle"):t("deleteClientProfileConfirmTitle"),messageKey:u?.name?t("deleteExecutorProfileConfirm",{executorName:u.name}):t("deleteClientProfileConfirm",{profileName:l}),continueButtonLabel:t("delete"),continueButtonVariant:te.danger,onConfirm:async()=>{if(u?.name){K(u.idx);try{await p.clientPolicies.createProfiles({...m,profiles:[...m.profiles||[],B()]}),v(t("deleteExecutorSuccess"),y.success),C(N({realm:n,profileName:l}))}catch(r){k(t("deleteExecutorError"),r)}}else try{await p.clientPolicies.createProfiles(m),v(t("deleteClientSuccess"),y.success),C(T({realm:n,tab:"profiles"}))}catch(r){k(t("deleteClientError"),r)}}});return m?o(x,{children:[e(J,{}),e(Ce,{titleKey:c?l:t("newClientProfile"),badges:[{id:"global-client-profile-badge",text:a?e(ie,{color:"blue",children:t("global")}):""}],divider:!0,dropdownItems:c&&!a?[e(ae,{value:"delete",onClick:I,"data-testid":"deleteClientProfileDropdown",children:t("deleteClientProfile")},"delete")]:void 0}),e(oe,{variant:"light",children:e(le,{...E,children:o(he,{isHorizontal:!0,role:"view-realm",className:"pf-v5-u-mt-lg",children:[e(se,{name:"name",label:t("newClientProfileName"),helperText:t("createClientProfileNameHelperText"),readOnly:a,rules:{required:t("required")}}),e(ne,{name:"description",label:t("description"),readOnly:a}),o(ce,{children:[!a&&e(d,{variant:"primary",onClick:()=>V(z)(),"data-testid":"saveCreateProfile",isDisabled:!D,children:t("save")}),c&&!a&&e(d,{id:"reloadProfile",variant:"link","data-testid":"reloadProfile",isDisabled:!D,onClick:R,children:t("reload")}),!c&&!a&&e(d,{id:"cancelCreateProfile",variant:"link",component:r=>e(P,{...r,to:T({realm:n,tab:"profiles"})}),"data-testid":"cancelCreateProfile",children:t("cancel")})]}),c&&o(x,{children:[o(ge,{children:[e(A,{children:o(w,{className:"kc-executors",component:L.h1,children:[t("executors"),e(S,{helpText:t("executorsHelpText"),fieldLabelId:"executors"})]})}),!a&&e(A,{align:{default:"alignRight"},children:e(d,{id:"addExecutor",component:r=>e(P,{...r,to:de({realm:n,profileName:l})}),variant:"link",className:"kc-addExecutor","data-testid":"addExecutor",icon:e(me,{}),children:t("addExecutor")})})]}),g.length>0&&o(x,{children:[e(ve,{"aria-label":t("executors"),isCompact:!0,children:g.map((r,s)=>e(ke,{"aria-labelledby":"executors-list-item",id:r.executor,children:e(ye,{"data-testid":"executors-list-row",children:e(Te,{dataListCells:[o(Ee,{"data-testid":"executor-type",children:[r.configuration?e(d,{component:i=>e(P,{...i,to:ue({realm:n,profileName:l,executorName:r.executor})}),variant:"link","data-testid":"editExecutor",children:r.executor}):e("span",{className:"kc-unclickable-executor",children:r.executor}),O?.filter(i=>i.id===r.executor).map(i=>o(xe,{children:[e(S,{helpText:i.helpText,fieldLabelId:"executorTypeTextHelpText"},i.id),!a&&e(d,{variant:"link",isInline:!0,icon:e(De,{className:"kc-executor-trash-icon","data-testid":"deleteExecutor"},`executorType-trash-icon-${i.id}`),onClick:()=>{I(),$({idx:s,name:i.id})},"aria-label":t("remove")})]},i.id))]},"executor")]})})},r.executor))}),a&&e(d,{id:"backToClientPolicies",component:r=>e(P,{...r,to:T({realm:n,tab:"profiles"})}),variant:"primary",className:"kc-backToPolicies","data-testid":"backToClientPolicies",children:t("back")})]}),g.length===0&&o(x,{children:[e(fe,{}),e(w,{className:"kc-emptyExecutors",component:L.h2,children:t("emptyExecutors")})]})]})]})})})]}):e(re,{})}export{Oe as default};
//# sourceMappingURL=ClientProfileForm-YZNWziWq.js.map
