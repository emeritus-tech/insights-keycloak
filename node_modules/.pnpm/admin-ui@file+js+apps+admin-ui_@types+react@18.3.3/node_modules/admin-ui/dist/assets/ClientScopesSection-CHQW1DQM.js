import{jsxs as F,Fragment as P,jsx as t}from"react/jsx-runtime";import{useState as s}from"react";import{u as E,c as N,a as R,f as V,v as G,B as Q,l as x,au as X,P as Y,a2 as w,j as Z,L as j,aA as _,J as $,K as ee,aB as te,N as oe,D as ne,aC as O,az as ae,x as le}from"./main-DXDh8SEc.js";import{g as re}from"./utils-DeGqqWSp.js";import{A as u,r as ce,a as se,c as ie,C as v}from"./ClientScopeTypes-DaGfhuW4.js";import{u as pe}from"./ConfirmDialog-o8TAA2Kj.js";import{K as de}from"./KeycloakDataTable-B3eTS_qk.js";import{V as me}from"./ViewHeader-DTd0a4sz.js";import{S as Se,a as ue,C as he,n as ye,t as fe,p as ge}from"./SearchFilter-l_i7W2ya.js";import{T as B}from"./Td-BmSS9qQq.js";import"react-dom";import"./PaginatingTableToolbar-zbU1l_6-.js";import"./EmptyStateFooter-C_ktbNPy.js";import"./EmptyStateActions-CiPKPOdJ.js";import"./_baseFlatten-CMLUuI8z.js";import"./filter-icon-Do5tIUfA.js";import"./grip-vertical-icon-CgFEKIXW.js";const Ce=o=>{const{adminClient:i}=E(),{t:n}=R(),{addAlert:h,addError:d}=V();return t(se,{clientScope:o,type:o.type,all:!0,onSelect:async m=>{try{await ie(i,o,m),h(n("clientScopeSuccess"),x.success),o.refresh()}catch(p){d("clientScopeError",p)}}})},be=({id:o,name:i})=>{const{realm:n}=N();return t(j,{to:ae({realm:n,id:o,tab:"settings"}),children:i},o)};function Ie(){const{adminClient:o}=E(),{realm:i}=N(),{t:n}=R(),{addAlert:h,addError:d}=V(),[m,p]=s(!1),[a,y]=s([]),[l,T]=s("name"),[D,f]=s(u.none),[K,g]=s("all"),I=G(),[A,U]=s(0),r=()=>{y([]),U(A+1)},M=async(e,L,c)=>{const S=await o.clientScopes.listDefaultClientScopes(),H=await o.clientScopes.listDefaultOptionalClientScopes(),J=await o.clientScopes.find(),W=l==="name"?ye(c):l==="type"?fe(D):ge(K),q=J.map(C=>({...C,type:S.find(b=>b.name===C.name)?v.default:H.find(b=>b.name===C.name)?v.optional:u.none})).filter(W);return I(q,le("name")).slice(e,Number(e)+Number(L))},[k,z]=pe({titleKey:n("deleteClientScope",{count:a.length,name:a[0]?.name}),messageKey:"deleteConfirmClientScopes",continueButtonLabel:"delete",continueButtonVariant:Q.danger,onConfirm:async()=>{const e=await o.clientScopes.find();if(Object.keys(e).length-a.length>0)try{for(const c of a){try{await ce(o,c)}catch(S){console.warn("could not remove scope",S.response?.data?.errorMessage||S)}await o.clientScopes.del({id:c.id})}h(n("deletedSuccessClientScope"),x.success),r()}catch(c){d("deleteErrorClientScope",c)}else d(n("notAllowedToDeleteAllClientScopes"),"error")}});return F(P,{children:[t(z,{}),t(me,{titleKey:"clientScopes",subKey:"clientScopeExplain",helpUrl:X.clientScopesUrl}),t(Y,{variant:"light",className:"pf-v5-u-p-0",children:t(de,{loader:M,ariaLabelKey:"clientScopeList",searchPlaceholderKey:l==="name"?"searchForClientScope":void 0,isSearching:l!=="name",searchTypeComponent:t(Se,{searchType:l,onSelect:e=>T(e),withProtocol:!0}),isPaginated:!0,onSelect:e=>y([...e]),canSelectAll:!0,toolbarItem:F(P,{children:[t(ue,{searchType:l,type:D,onSelect:e=>{T(e),g("all"),f(u.none),r()},onType:e=>{f(e),g("all"),r()},protocol:K,onProtocol:e=>{g(e),f(u.none),r()}}),t(w,{children:t(Z,{component:e=>t(j,{...e,to:_({realm:i})}),children:n("createClientScope")})}),t(w,{children:t(he,{selectedRows:a,refresh:r})}),t(w,{children:t($,{shouldFocusToggleOnSelect:!0,onOpenChange:e=>p(e),toggle:e=>t(ee,{"data-testid":"kebab","aria-label":"Kebab toggle",ref:e,onClick:()=>p(!m),variant:"plain",children:t(te,{})}),isOpen:m,children:t(oe,{children:t(ne,{"data-testid":"delete",isDisabled:a.length===0,onClick:()=>{k(),p(!1)},children:n("delete")})})})})]}),actions:[{title:n("delete"),onRowClick:e=>{y([e]),k()}}],columns:[{name:"name",cellRenderer:be},{name:"type",displayKey:"assignedType",cellRenderer:e=>t(Ce,{...e,refresh:r})},{name:"protocol",displayKey:"protocol",cellRenderer:e=>re(n,e.protocol??"openid-connect"),transforms:[B(15)]},{name:"attributes['gui.order']",displayKey:"displayOrder",cellFormatters:[O()],transforms:[B(15)]},{name:"description",cellFormatters:[O()]}]},A)})]})}export{Ie as default};
//# sourceMappingURL=ClientScopesSection-CHQW1DQM.js.map
